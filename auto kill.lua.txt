local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local punchAnimationIds = {
    "rbxassetid://3638729053",
    "rbxassetid://3638749874",
    "rbxassetid://3638767427",
    "rbxassetid://102357151005774",
}

local function stopPunchAnimations(humanoid)
    local animator = humanoid:FindFirstChildOfClass("Animator")
    if animator then
        for _, track in pairs(animator:GetPlayingAnimationTracks()) do
            for _, animId in ipairs(punchAnimationIds) do
                if track.Animation.AnimationId == animId then
                    track:Stop()
                    track:Destroy()
                end
            end
        end
    end
end

local function autoKillLoop(punch, hand)
    RunService.Heartbeat:Connect(function()
        punch.attackTime.Value = 0
    end)
    RunService.Stepped:Connect(function()
        punch.attackTime.Value = 0
        for _, plr in pairs(Players:GetPlayers()) do
            if plr ~= player and plr.Character then
                local targetHumanoid = plr.Character:FindFirstChild("Humanoid")
                local targetHRP = plr.Character:FindFirstChild("HumanoidRootPart")
                if targetHumanoid and targetHumanoid.Health > 0 and targetHRP then
                    punch:Activate()
                    firetouchinterest(targetHRP, hand, 0)
                    firetouchinterest(targetHRP, hand, 1)
                end
            end
        end
    end)
end

local function onCharacterAdded(char)
    local bp = player:WaitForChild("Backpack")
    local humanoid = char:WaitForChild("Humanoid")
    local hand = char:FindFirstChild("LeftHand") or char:FindFirstChild("Left Arm")
    repeat
        task.wait(0.1)
        if not char:FindFirstChild("Punch") then
            local punchTool = bp:FindFirstChild("Punch")
            if punchTool then
                humanoid:EquipTool(punchTool)
            end
        end
    until char:FindFirstChild("Punch")
    local punch = char:FindFirstChild("Punch")
    if not punch or not hand then return end
    punch.attackTime.Value = 0
    RunService.Heartbeat:Connect(function()
        stopPunchAnimations(humanoid)
        local currentTool = humanoid:FindFirstChildOfClass("Tool")
        if currentTool and currentTool.Name ~= "Punch" then
            local punchTool = bp:FindFirstChild("Punch")
            if punchTool then
                humanoid:EquipTool(punchTool)
            end
        end
    end)
    autoKillLoop(punch, hand)
end

Players.PlayerAdded:Connect(function(plr)
    plr.CharacterAdded:Connect(onCharacterAdded)
end)

player.CharacterAdded:Connect(onCharacterAdded)
if player.Character then
    onCharacterAdded(player.Character)
end